---
name: strategic-compact
description: 建议在逻辑间隔处手动进行上下文压缩，以通过任务阶段保持上下文，而非依赖任意的自动压缩。
---

# 战略性压缩技能

建议在工作流程中的关键节点手动执行 `/compact`，而不是依赖任意的自动压缩。

## 为什么要进行战略性压缩？

自动压缩会在任意时刻触发：
- 通常在任务中途，导致重要上下文丢失
- 无法识别逻辑任务边界
- 可能中断复杂的多步骤操作

在逻辑边界处进行战略性压缩：
- **探索后，执行前** — 压缩调研上下文，保留实施计划
- **完成里程碑后** — 为下一阶段开启全新状态
- **重大上下文切换前** — 清理探索上下文以切换不同任务

## 工作原理

`suggest-compact.sh` 脚本在 PreToolUse（编辑/写作）阶段运行，并且：

1. **跟踪工具调用** — 统计会话中的工具调用次数
2. **阈值检测** — 在可配置阈值处建议压缩（默认：50 次调用）
3. **周期提醒** — 阈值后每 25 次调用提醒一次

## 钩子设置

添加到你的 `~/.claude/settings.json`：

```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "tool == \"Edit\" || tool == \"Write\"",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/skills/strategic-compact/suggest-compact.sh"
      }]
    }]
  }
}
```

## 配置

环境变量：
- `COMPACT_THRESHOLD` — 首次建议压缩前的工具调用次数（默认：50）

## 最佳实践

1. **规划完成后压缩** — 计划确定后压缩，开启全新状态
2. **调试后压缩** — 清理错误解决上下文后继续
3. **避免在实施中途压缩** — 保留相关变更的上下文
4. **阅读建议内容** — 钩子告诉你*何时*压缩，是否压缩由你决定

## 相关内容

- [长文指南](https://x.com/affaanmustafa/status/2014040193557471352) — 令牌优化章节
- 内存持久化钩子 — 用于在压缩后保持状态